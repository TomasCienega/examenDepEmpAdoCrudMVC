@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Lista Empleado";
}
@model List<examenDepEmpAdoCrudMVC.Models.Empleado>


<div class="container mt-4">
    <div class="row mb-3">
        <div class="col">
            <h2><i class="bi bi-layout-text-window-reverse"></i> CRUD Empleados</h2>
            <a asp-action="Crear" class="btn btn-success mb-3">
                <i class="bi bi-plus-circle"></i> Nuevo Usuario
            </a>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-7">
            <div class="card mb-2 shadow-sm">
                <div class="card-body bg-light">
                    <form method="get" asp-action="FiltrarPorDepartamento" class="row g-2 align-items-center justify-content-between">
                        <div class="col-auto d-flex align-items-center">
                            <label class="fw-bold me-2">Filtrar por departamento</label>
                            <div style="width: 250px;">
                                <select name="idD" class="form-select" onchange="this.form.submit()">
                                    <option value="0">-- Departamentos</option>
                                    @foreach (var dep in (ViewBag.Departamentos as List<examenDepEmpAdoCrudMVC.Models.Departamento> ?? new List<examenDepEmpAdoCrudMVC.Models.Departamento>()))
                                    {
                                        <option value="@dep.IdDepartamento" selected="@(ViewBag.IdSelected == dep.IdDepartamento ? "selected" : null)">
                                            @dep.NombreDepartamento
                                        </option>
                                    }
                                </select>
                            </div>
                        </div>

                        <div class="col-auto">
                            <a asp-action="Index" class="btn btn-outline-secondary">Limpiar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-5">
            <form method="get" asp-action="FiltrarPorNombre" class="d-flex align-items-center">
                <div class="input-group me-2">
                    <input type="text" name="nombre" class="form-control"
                           placeholder="Buscar por nombre..." value="@ViewBag.NombreActual" />
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
                    <a asp-action="Index" class="btn btn-outline-secondary">Limpiar</a>
            </form>
        </div>
    </div>
    <table class="table table-hover shadow-sm border">
        <thead class="table-info">
            <tr>
                <th>ID</th>
                <th>NombreEmpleado</th>
                <th>Departamento</th>
                <th>Estatus</th>
                <th style="width: 320px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="6" class="text-center text-muted italic">
                        No se encontraron empleados con los criterios seleccionados.
                    </td>
                </tr>
            }
            else
            {
                @foreach (var emp in Model)
                {
                    <tr>
                        <td>@emp.IdEmpleado</td>
                        <td>@emp.NombreEmpleado</td>
                        <td>@emp.ReferenciaDepartamento?.NombreDepartamento</td>

                        <td>
                            @* es cmo hacer lo e abajo pero mas simplificado
                        @if (emp.Activo)
                        {
                            <span class="badge rounded-pill bg-success">Activo</span>
                        }
                        else
                        {
                            <span class="badge rounded-pill bg-secondary">Inactivo</span>
                        } 
                            *@
                            <span class="badge @(emp.Activo ? "bg-success" : "bg-secondary")">
                                @(emp.Activo ? "Activo" : "Inactivo")
                            </span>
                        </td>
                        <td>
                            <div class="d-flex flex-wrap gap-2">
                                <a asp-action="Editar" asp-route-idE="@emp.IdEmpleado" class="btn btn-sm btn-info">
                                    <i class="bi bi-pencil"></i> Editar
                                </a>

                                @if (emp.Activo)
                                {
                                    <a asp-action="CambiarEstado" asp-route-idE="@emp.IdEmpleado" class="btn btn-sm btn-secondary">
                                        Desactivar
                                    </a>
                                }
                                else
                                {
                                    <a asp-action="CambiarEstado" asp-route-idE="@emp.IdEmpleado" class="btn btn-sm btn-success">
                                        Activar
                                    </a>
                                }

                                <a asp-action="Eliminar" asp-route-idE="@emp.IdEmpleado" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i> Eliminar
                                </a>
                            </div>

                        </td>
                    </tr>
                }

            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        // Usamos comillas simples para envolver el valor del TempData
        // Usamos Html.Raw para que los acentos se pasen sin codificar
        var mensaje = '@Html.Raw(TempData["AlertMessage"])';
        var icono = '@TempData["AlertIcon"]';

        // Solo disparamos la alerta si el mensaje realmente tiene texto
        if (mensaje !== '') {
            Swal.fire({
                title: 'Notificación',
                text: mensaje,
                icon: icono,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Entendido',
                timer: 2500, // 2.5 segundos es el tiempo ideal de lectura
                timerProgressBar: true, // Muestra una barrita de tiempo abajo
                showConfirmButton: false // Oculta el botón para un look más limpio
            });
        }
    </script>
}
